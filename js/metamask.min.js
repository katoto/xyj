"use strict";var global_Second=30,xyj={},contractAddr="0x623dbcb14e4f6f9d74fe987a6c0718467722062c",contractAbi=[{constant:!0,inputs:[],name:"getBuyPrice",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_affCode",type:"bytes32"},{name:"_team",type:"uint256"},{name:"_eth",type:"uint256"}],name:"reLoadXname",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[],name:"activate",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"",type:"address"}],name:"pIDxAddr_",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"airDropTracker_",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"round_",outputs:[{name:"plyr",type:"uint256"},{name:"team",type:"uint256"},{name:"end",type:"uint256"},{name:"ended",type:"bool"},{name:"strt",type:"uint256"},{name:"keys",type:"uint256"},{name:"eth",type:"uint256"},{name:"pot",type:"uint256"},{name:"mask",type:"uint256"},{name:"ico",type:"uint256"},{name:"icoGen",type:"uint256"},{name:"icoAvg",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"},{name:"",type:"bytes32"}],name:"plyrNames_",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"fees_",outputs:[{name:"gen",type:"uint256"},{name:"p3d",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"bytes32"}],name:"pIDxName_",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_affCode",type:"uint256"},{name:"_team",type:"uint256"},{name:"_eth",type:"uint256"}],name:"reLoadXid",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[],name:"withdraw",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_nameString",type:"string"},{name:"_affCode",type:"address"},{name:"_all",type:"bool"}],name:"registerNameXaddr",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"_pID",type:"uint256"},{name:"_addr",type:"address"},{name:"_name",type:"bytes32"},{name:"_laff",type:"uint256"}],name:"receivePlayerInfo",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"},{name:"",type:"uint256"}],name:"rndTmEth_",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"rID_",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_pID",type:"uint256"}],name:"getPlayerVaults",outputs:[{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_nameString",type:"string"},{name:"_affCode",type:"bytes32"},{name:"_all",type:"bool"}],name:"registerNameXname",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[],name:"getCurrentRoundInfo",outputs:[{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"address"},{name:"",type:"bytes32"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_affCode",type:"address"},{name:"_team",type:"uint256"},{name:"_eth",type:"uint256"}],name:"reLoadXaddr",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_affCode",type:"uint256"},{name:"_team",type:"uint256"}],name:"buyXid",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"_pID",type:"uint256"},{name:"_name",type:"bytes32"}],name:"receivePlayerNameList",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_nameString",type:"string"},{name:"_affCode",type:"uint256"},{name:"_all",type:"bool"}],name:"registerNameXID",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_affCode",type:"address"},{name:"_team",type:"uint256"}],name:"buyXaddr",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"},{name:"",type:"uint256"}],name:"plyrRnds_",outputs:[{name:"eth",type:"uint256"},{name:"keys",type:"uint256"},{name:"mask",type:"uint256"},{name:"ico",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_affCode",type:"bytes32"},{name:"_team",type:"uint256"}],name:"buyXname",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"potSplit_",outputs:[{name:"gen",type:"uint256"},{name:"p3d",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getTimeLeft",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_rID",type:"uint256"},{name:"_eth",type:"uint256"}],name:"calcKeysReceived",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_keys",type:"uint256"}],name:"iWantXKeys",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"activated_",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"airDropPot_",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"plyr_",outputs:[{name:"addr",type:"address"},{name:"name",type:"bytes32"},{name:"win",type:"uint256"},{name:"gen",type:"uint256"},{name:"aff",type:"uint256"},{name:"lrnd",type:"uint256"},{name:"laff",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_addr",type:"address"}],name:"getPlayerInfoByAddress",outputs:[{name:"",type:"uint256"},{name:"",type:"bytes32"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{payable:!0,stateMutability:"payable",type:"fallback"},{anonymous:!1,inputs:[{indexed:!0,name:"playerID",type:"uint256"},{indexed:!0,name:"playerAddress",type:"address"},{indexed:!0,name:"playerName",type:"bytes32"},{indexed:!1,name:"isNewPlayer",type:"bool"},{indexed:!1,name:"affiliateID",type:"uint256"},{indexed:!1,name:"affiliateAddress",type:"address"},{indexed:!1,name:"affiliateName",type:"bytes32"},{indexed:!1,name:"amountPaid",type:"uint256"},{indexed:!1,name:"timeStamp",type:"uint256"}],name:"onNewName",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"compressedData",type:"uint256"},{indexed:!1,name:"compressedIDs",type:"uint256"},{indexed:!1,name:"playerName",type:"bytes32"},{indexed:!1,name:"playerAddress",type:"address"},{indexed:!1,name:"ethIn",type:"uint256"},{indexed:!1,name:"keysBought",type:"uint256"},{indexed:!1,name:"winnerAddr",type:"address"},{indexed:!1,name:"winnerName",type:"bytes32"},{indexed:!1,name:"amountWon",type:"uint256"},{indexed:!1,name:"newPot",type:"uint256"},{indexed:!1,name:"P3DAmount",type:"uint256"},{indexed:!1,name:"genAmount",type:"uint256"},{indexed:!1,name:"potAmount",type:"uint256"},{indexed:!1,name:"airDropPot",type:"uint256"}],name:"onEndTx",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"playerID",type:"uint256"},{indexed:!1,name:"playerAddress",type:"address"},{indexed:!1,name:"playerName",type:"bytes32"},{indexed:!1,name:"ethOut",type:"uint256"},{indexed:!1,name:"timeStamp",type:"uint256"}],name:"onWithdraw",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"playerAddress",type:"address"},{indexed:!1,name:"playerName",type:"bytes32"},{indexed:!1,name:"ethOut",type:"uint256"},{indexed:!1,name:"compressedData",type:"uint256"},{indexed:!1,name:"compressedIDs",type:"uint256"},{indexed:!1,name:"winnerAddr",type:"address"},{indexed:!1,name:"winnerName",type:"bytes32"},{indexed:!1,name:"amountWon",type:"uint256"},{indexed:!1,name:"newPot",type:"uint256"},{indexed:!1,name:"P3DAmount",type:"uint256"},{indexed:!1,name:"genAmount",type:"uint256"}],name:"onWithdrawAndDistribute",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"playerAddress",type:"address"},{indexed:!1,name:"playerName",type:"bytes32"},{indexed:!1,name:"ethIn",type:"uint256"},{indexed:!1,name:"compressedData",type:"uint256"},{indexed:!1,name:"compressedIDs",type:"uint256"},{indexed:!1,name:"winnerAddr",type:"address"},{indexed:!1,name:"winnerName",type:"bytes32"},{indexed:!1,name:"amountWon",type:"uint256"},{indexed:!1,name:"newPot",type:"uint256"},{indexed:!1,name:"P3DAmount",type:"uint256"},{indexed:!1,name:"genAmount",type:"uint256"}],name:"onBuyAndDistribute",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"playerAddress",type:"address"},{indexed:!1,name:"playerName",type:"bytes32"},{indexed:!1,name:"compressedData",type:"uint256"},{indexed:!1,name:"compressedIDs",type:"uint256"},{indexed:!1,name:"winnerAddr",type:"address"},{indexed:!1,name:"winnerName",type:"bytes32"},{indexed:!1,name:"amountWon",type:"uint256"},{indexed:!1,name:"newPot",type:"uint256"},{indexed:!1,name:"P3DAmount",type:"uint256"},{indexed:!1,name:"genAmount",type:"uint256"}],name:"onReLoadAndDistribute",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"affiliateID",type:"uint256"},{indexed:!1,name:"affiliateAddress",type:"address"},{indexed:!1,name:"affiliateName",type:"bytes32"},{indexed:!0,name:"roundID",type:"uint256"},{indexed:!0,name:"buyerID",type:"uint256"},{indexed:!1,name:"amount",type:"uint256"},{indexed:!1,name:"timeStamp",type:"uint256"}],name:"onAffiliatePayout",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"roundID",type:"uint256"},{indexed:!1,name:"amountAddedToPot",type:"uint256"}],name:"onPotSwapDeposit",type:"event"}];"undefined"==typeof web3&&(web3=new Web3(new Web3.providers.HttpProvider("https://mainnet.infura.io/WlvljmHqo75RhK1w1QJF")));var contractNet=web3.eth.contract(contractAbi).at(contractAddr);xyj.getAccounts=function(fn){if("function"!=typeof fn)return"need async function !.";web3.eth.getAccounts(function(err,res){err?fn("getAccounts err",null):res?fn(null,res.toString()):fn(err,null)})},xyj.getGasPrice=function(fn){if("function"!=typeof fn)return"need async function !.";web3.eth.getGasPrice(function(err,res){err?fn(new Error("getGasPrice error"),null):res?fn(null,res.toNumber(10)):fn(err,null)})},xyj.getTimeLeft=function(fn){if("function"!=typeof fn)return"need async function !.";contractNet?contractNet.getTimeLeft(function(err,res){err?fn(err,null):res&&fn(null,res.toNumber(10))}):fn("contractNet error at getTimeLeft",null)},xyj.getPlayerInfoByAddress=function(addr,fn){return"string"!=typeof addr?"need string addr !.":"function"!=typeof fn?"need async function !.":void(contractNet?contractNet.getPlayerInfoByAddress(addr,function(err,res){err?fn("getPlayerInfoByAddress error",null):res&&fn(null,{id:res[0].toString(),inviteName:web3.toUtf8(res[1]),keys:Math.ceil(res[2].toNumber()/Math.pow(10,18)),earn:web3.fromWei(res[4].toNumber()),totalEarn:web3.fromWei(res[5].toNumber()+res[3].toNumber()+res[4].toNumber()),shareEarn:web3.fromWei(res[5].toNumber()),payMoney:web3.fromWei(res[6].toNumber()),winningValue_3:web3.fromWei(res[3].toNumber()),winningValue_4:web3.fromWei(res[4].toNumber())})}):fn("contractNet error at getPlayerInfoByAddress",null))},xyj.getCurrentRoundInfo=function(fn){if("function"!=typeof fn)return"need async function !.";contractNet?contractNet.getCurrentRoundInfo(function(err,res){err?fn("getCurrentRoundInfo error",null):res&&fn(null,{roundNum:res[1].toNumber(),totalKey:Math.ceil(res[2].toNumber()/Math.pow(10,18)),currPot:web3.fromWei(res[5].toNumber()),startedTime:res[4].toNumber(),endedTime:res[3].toNumber(),whales_0:web3.fromWei(res[9].toNumber()),bears_1:web3.fromWei(res[10].toNumber()),sneks_2:web3.fromWei(res[11].toNumber()),bulls_3:web3.fromWei(res[12].toNumber()),purchasedSeconds:Math.ceil(res[2].toNumber()/Math.pow(10,18))*global_Second,purchasedTime:Math.ceil(res[2].toNumber()/Math.pow(10,18))*global_Second/31536e3,lastBuyAddr:res[7].toString(),lastBuyName:web3.toUtf8(res[8])})}):fn("contractNet error at getCurrentRoundInfo",null)},xyj.getBuyPrice=function(fn){if("function"!=typeof fn)return"need async function !.";contractNet.getBuyPrice(function(err,res){if(err)fn("getBuyPrice error",null);else if(res){var web3_getBuyPrice=res.toNumber(10);fn(null,web3_getBuyPrice/Math.pow(10,18))}})},xyj.iWantXKeys=function(keyNum,fn){if("number"!=typeof keyNum)return"keyNum need number";contractNet?contractNet.iWantXKeys(web3.toWei(parseFloat(keyNum)),function(err,res){err?fn(err,null):res&&(console.log(res),console.log(web3.fromWei(res.toNumber())),fn(null,!0))}):fn("contractNet error at registerNameXaddr",null)},xyj.withdraw=function(fn){if("function"!=typeof fn)return"need async function !.";contractNet.withdraw(function(err,res){err?fn("withdraw error",null):res&&fn(null,!0)})},xyj.registerNameXname=function(regName,_affCode,fn){return"string"!=typeof regName?"need string regName !.":"string"!=typeof _affCode?"need string _affCode name !.":"function"!=typeof fn?"need async function !.":void(contractNet?contractNet.registerNameXname(regName.toString(),_affCode,!0,{value:web3.toWei("0.01","ether")},function(err,res){err?fn(err,null):res&&fn(null,!0)}):fn("contractNet error at registerNameXname",null))},xyj.registerNameXaddr=function(regName,_affCode,fn){return"string"!=typeof regName?"need string regName !.":"string"!=typeof _affCode?"need string _affCode addr !.":"function"!=typeof fn?"need async function !.":void(contractNet?contractNet.registerNameXaddr(regName.toString(),_affCode,!0,{value:web3.toWei("0.01","ether")},function(err,res){err?fn(err,null):res&&fn(null,!0)}):fn("contractNet error at registerNameXaddr",null))},xyj.registerNameXID=function(regName,_affCode,fn){return"string"!=typeof regName?"need string regName !.":"number"!=typeof _affCode?"need number _affCode id !.":"function"!=typeof fn?"need async function !.":void(contractNet?contractNet.registerNameXID(regName.toString(),_affCode,!0,{value:web3.toWei("0.01","ether")},function(err,res){err?fn(err,null):res&&fn(null,!0)}):fn("contractNet error at registerNameXname",null))},xyj.getRound=function(fn){contractNet?this.getCurrentRoundInfo(function(error,result){result&&contractNet.round_(parseFloat(result.roundNum),function(err,res){if(err)fn(err,null);else if(res){var roundObj=null;roundObj=res[6].toNumber()-res[7].toNumber()<0?{totalEth:web3.fromWei(res[6].toNumber()),distributionEth:0,roundPot:web3.fromWei(res[7].toNumber())}:{totalEth:web3.fromWei(res[6].toNumber()),distributionEth:web3.fromWei(res[6].toNumber()-res[7].toNumber()),roundPot:web3.fromWei(res[7].toNumber())},fn(null,roundObj)}})}):fn("contractNet error at getRound",null)},contractNet.allEvents(function(err,res){if(err)console.error("allEvents"+error);else if(res){var name=web3.toUtf8(res.args.playerName);if(window.refreshTime(),xyj._account&&window.refreshPersonInfo(),window.refreshInfo(),console.log(res.event,res.args),"onEndTx"===res.event){var keyNums=Math.ceil(res.args.keysBought.toNumber()/Math.pow(10,18));xyj._account===res.args.playerAddress?alertify.success(1===keyNums?_("您已成功购买{0}个金钻",keyNums):_("您已成功购买{0}个金钻 ",keyNums)):""!==name?alertify.success(1===keyNums?_("{0}已成功购买{1}个金钻",name,keyNums):_("{0}已成功购买{1}个金钻 ",name,keyNums)):""===name&&alertify.success(1===keyNums?_("有小伙伴已成功购买{0}个金钻",keyNums):_("有小伙伴已成功购买{0}个金钻 ",keyNums))}else if("onNewName"===res.event)""===name?alertify.success(_("有小伙伴已成功购买专属的推广代号")):alertify.success(_("全体起立，欢迎{0}成功购买专属的推广代号",name));else if("onWithdraw"===res.event||"onWithdrawAndDistribute"===res.event){var withdrawNum=window.formatNum6(web3.fromWei(res.args.ethOut.toNumber()));xyj._account===res.args.playerAddress?alertify.success(_("您已成功提现{0}ETH!",withdrawNum)):""===name?alertify.success(_("有小伙伴已成功提现{0}ETH!",withdrawNum)):alertify.success(name+_("已成功提现{0}ETH!",withdrawNum)),"onWithdrawAndDistribute"===res.event&&setTimeout(function(){alertify.success(_("请注意，新一轮的游戏准备开始"))},1e3)}else"onBuyAndDistribute"===res.event&&(xyj._account===res.args.playerAddress?alertify.alert(_("您已成功激活新一轮的游戏，激活游戏不会花费您的ETH，快来马上买钻取“金”吧")):alertify.success(_("请注意，新一轮的游戏准备开始")))}console.log("== 用于 实时播报 ====")}),xyj.buyXaddr=function(_affCode,_team,totalVal,fn){return"string"!=typeof _affCode?(fn("_affCode param 1 need Sting ( addr )",null),"_affCode param 1 need Sting ( addr )"):"number"!=typeof _team?(fn("_team param 2 need number (0,1,2,3)",null),"_team param 2 need number (0,1,2,3)"):("string"==typeof totalVal&&(totalVal=parseFloat(totalVal)),totalVal?void contractNet.buyXaddr(_affCode,parseInt(_team),{value:web3.toWei(totalVal,"ether")},function(err,res){err?fn(err,null):res?fn(null,res):fn("buyXaddr error",null)}):(fn("totalVal param 3 error",null),"totalVal param 3 error"))},xyj.buyXname=function(_affCode,_team,totalVal,fn){return"string"!=typeof _affCode?(fn("_affCode param 1 need Sting ( addr )",null),"_affCode param 1 need Sting ( addr )"):"number"!=typeof _team?(fn("_team param 2 need number (0,1,2,3)",null),"_team param 2 need number (0,1,2,3)"):("string"==typeof totalVal&&(totalVal=parseFloat(totalVal)),totalVal?void contractNet.buyXname(_affCode,parseInt(_team),{value:web3.toWei(totalVal,"ether")},function(err,res){err?fn(err,null):res?fn(null,res):fn("buyXname error",null)}):(fn("totalVal param 3 error",null),"totalVal param 3 error"))},xyj.buyXid=function(_affCode,_team,totalVal,fn){return"number"!=typeof _affCode?(fn("_affCode param 1 need number ( id )",null),"_affCode param 1 need number ( id )"):"number"!=typeof _team?(fn("_team param 2 need number (0,1,2,3)",null),"_team param 2 need number (0,1,2,3)"):("string"==typeof totalVal&&(totalVal=parseFloat(totalVal)),totalVal?void contractNet.buyXid(_affCode,parseInt(_team),{value:web3.toWei(totalVal,"ether")},function(err,res){err?fn(err,null):res?fn(null,res):fn("buyXid error",null)}):(fn("totalVal param 3 error",null),"totalVal param 3 error"))};